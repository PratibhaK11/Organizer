{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);useEffect(()=>{const checkAuth=async()=>{try{const res=await axios.get('/api/users/current',{withCredentials:true// Ensure credentials are sent with request\n});setUser(res.data.user);}catch(err){console.error('Auth check error:',err.response?err.response.data:err.message);// Log error details\nsetUser(null);}};checkAuth();},[]);const login=async(email,password)=>{try{const res=await axios.post('/api/users/login',{email,password},{withCredentials:true// Ensure credentials are sent with request\n});setUser(res.data.user);}catch(err){console.error('Login error:',err.response?err.response.data:err.message);// Log error details\nthrow err;}};const register=async(name,email,password,password2)=>{try{await axios.post('/api/users/register',{name,email,password,password2},{withCredentials:true// Ensure credentials are sent with request\n});}catch(err){console.error('Register error:',err.response?err.response.data:err.message);// Log error details\nthrow err;}};const logout=async()=>{try{// Call unsubscribeUser before logging out\nawait unsubscribeUser();await axios.get('/api/users/logout',{withCredentials:true// Ensure credentials are sent with request\n});setUser(null);}catch(err){console.error('Logout error:',err.response?err.response.data:err.message);// Log error details\nthrow err;}};const unsubscribeUser=async()=>{if('serviceWorker'in navigator&&'PushManager'in window){try{const registration=await navigator.serviceWorker.ready;const subscription=await registration.pushManager.getSubscription();if(subscription){await subscription.unsubscribe();// Notify server to remove subscription\nawait axios.post('/api/notifications/unsubscribe',{endpoint:subscription.endpoint},{withCredentials:true});}}catch(error){console.error('Error unsubscribing from push notifications:',error);}}else{console.warn('Push notifications or service worker are not supported in this browser.');}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,login,register,logout},children:children});};export{AuthContext,AuthProvider};","map":{"version":3,"names":["React","createContext","useState","useEffect","axios","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","checkAuth","res","get","withCredentials","data","err","console","error","response","message","login","email","password","post","register","name","password2","logout","unsubscribeUser","navigator","window","registration","serviceWorker","ready","subscription","pushManager","getSubscription","unsubscribe","endpoint","warn","Provider","value"],"sources":["C:/Users/dell/Desktop/Organizer/organizer-app/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext();\r\n\r\nconst AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const checkAuth = async () => {\r\n      try {\r\n        const res = await axios.get('/api/users/current', {\r\n          withCredentials: true // Ensure credentials are sent with request\r\n        });\r\n        setUser(res.data.user);\r\n      } catch (err) {\r\n        console.error('Auth check error:', err.response ? err.response.data : err.message); // Log error details\r\n        setUser(null);\r\n      }\r\n    };\r\n    checkAuth();\r\n  }, []);\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      const res = await axios.post('/api/users/login', { email, password }, {\r\n        withCredentials: true // Ensure credentials are sent with request\r\n      });\r\n      setUser(res.data.user);\r\n    } catch (err) {\r\n      console.error('Login error:', err.response ? err.response.data : err.message); // Log error details\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  const register = async (name, email, password, password2) => {\r\n    try {\r\n      await axios.post('/api/users/register', { name, email, password, password2 }, {\r\n        withCredentials: true // Ensure credentials are sent with request\r\n      });\r\n    } catch (err) {\r\n      console.error('Register error:', err.response ? err.response.data : err.message); // Log error details\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      // Call unsubscribeUser before logging out\r\n      await unsubscribeUser();\r\n      \r\n      await axios.get('/api/users/logout', {\r\n        withCredentials: true // Ensure credentials are sent with request\r\n      });\r\n      setUser(null);\r\n    } catch (err) {\r\n      console.error('Logout error:', err.response ? err.response.data : err.message); // Log error details\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  const unsubscribeUser = async () => {\r\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\r\n      try {\r\n        const registration = await navigator.serviceWorker.ready;\r\n        const subscription = await registration.pushManager.getSubscription();\r\n        \r\n        if (subscription) {\r\n          await subscription.unsubscribe();\r\n\r\n          // Notify server to remove subscription\r\n          await axios.post('/api/notifications/unsubscribe', {\r\n            endpoint: subscription.endpoint\r\n          }, {\r\n            withCredentials: true\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('Error unsubscribing from push notifications:', error);\r\n      }\r\n    } else {\r\n      console.warn('Push notifications or service worker are not supported in this browser.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, login, register, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport { AuthContext, AuthProvider };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}